---- EMPLOYEE Table --
    --CREATE TABLE EMPLOYEE (
    --    EMP_ID VARCHAR2(10) PRIMARY KEY,
    --    FIRST_NAME VARCHAR2(50) NOT NULL,
    --    LAST_NAME VARCHAR2(50),
    --    CONTACT_NUMBER VARCHAR2(20),
    --    PASSWORD VARCHAR2(255) NOT NULL,
    --    POSITION VARCHAR2(20) DEFAULT 'employee' CHECK (POSITION IN ('admin', 'employee')) NOT NULL,
    --    STATUS VARCHAR2(20) DEFAULT 'active'
    --        CHECK (STATUS IN ('active', 'inactive'))
    --);
--
---- DatePicker --
    --ALTER TABLE EMPLOYEE
    --ADD CREATED_AT DATE DEFAULT SYSDATE;


--USER Table for login -- 
    --CREATE TABLE "USER" (
    --    USER_ID VARCHAR2(10),
    --    USER_NAME VARCHAR2(50) NOT NULL UNIQUE,
    --    PASSWORD VARCHAR2(255) NOT NULL,
    --    ROLE VARCHAR2(20) DEFAULT 'employee' CHECK (ROLE IN ('admin', 'employee')) NOT NULL,
    --    EMPLOYEE_ID VARCHAR2(10),
    --    CREATED_AT DATE DEFAULT SYSDATE,
    --    CONSTRAINT FK_USER_EMPLOYEE FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEE(EMP_ID) ON DELETE SET NULL
    --);
    
    
    
--
--CREATE SEQUENCE user_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
--
--CREATE OR REPLACE TRIGGER trg_user_id
--BEFORE INSERT ON "USER"
--FOR EACH ROW
--BEGIN
--    IF :NEW.USER_ID IS NULL THEN
--        :NEW.USER_ID := 'U' || LPAD(user_seq.NEXTVAL, 3, '0');  -- U001, U002, U003...
--    END IF;
--END;
--/

--INSERT INTO EMPLOYEE (EMP_ID, FIRST_NAME, LAST_NAME, CONTACT_NUMBER, POSITION, PASSWORD)
--VALUES ('E002', 'Omar', 'Mohammed', '0788123465', 'employee', '123456');


--INSERT INTO "USER" (USER_NAME, PASSWORD, EMPLOYEE_ID)
--VALUES ('omar', '123456', 'E002');
--
--SELECT * FROM EMPLOYEE;
--SELECT USER_ID, USER_NAME, ROLE, EMPLOYEE_ID FROM "USER";
--
--DESCRIBE EMPLOYEE;
--DESCRIBE "USER";


--CREATE TABLE CUSTOMER (
--    CUS_ID VARCHAR2(10) PRIMARY KEY,
--    NAME VARCHAR2(100) NOT NULL,
--    ADDRESS VARCHAR2(255) NOT NULL,
--    CONTACT_NUMBER VARCHAR2(10) NOT NULL UNIQUE
--);



--CREATE TABLE PRODUCT (
--    PRODUCT_ID VARCHAR2(10) PRIMARY KEY,
--    PRODUCT_NAME VARCHAR2(100) NOT NULL UNIQUE,
--    PRODUCT_TYPE VARCHAR2(50) NOT NULL,
--    STOCK NUMBER(10) DEFAULT 0 NOT NULL,
--    PRICE NUMBER(10,2) NOT NULL,
--    IMAGE BLOB
--);


--ALTER TABLE "USER" ADD CONSTRAINT PK_USER PRIMARY KEY (USER_ID);
--
--
--CREATE TABLE SALE (
--    SALE_ID VARCHAR2(10) PRIMARY KEY,
--    CUS_NAME VARCHAR2(100) NOT NULL,
--    CUS_CONTACT VARCHAR2(20) NOT NULL,
--    TOTAL NUMBER(10,2) NOT NULL,
--    SALE_DATE DATE DEFAULT SYSDATE,
--    USER_ID VARCHAR2(10),
--    CONSTRAINT FK_SALE_USER FOREIGN KEY (USER_ID) REFERENCES "USER"(USER_ID) ON DELETE SET NULL
--);




--CREATE TABLE SALE_DETAIL (
--    SALE_DETAIL_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
--    SALE_ID VARCHAR2(10) NOT NULL,
--    PRODUCT_ID VARCHAR2(10) NOT NULL,
--    QUANTITY NUMBER(10) NOT NULL,
--    UNIT_PRICE NUMBER(10,2) NOT NULL,
--    CONSTRAINT FK_SALE_DETAIL_SALE FOREIGN KEY (SALE_ID) REFERENCES SALE(SALE_ID) ON DELETE CASCADE,
--    CONSTRAINT FK_SALE_DETAIL_PRODUCT FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID)
--);

--ALTER TABLE CUSTOMER
--MODIFY CONTACT_NUMBER VARCHAR2(15);
--
--
--INSERT INTO CUSTOMER (CUS_ID, NAME, ADDRESS, CONTACT_NUMBER) VALUES ('C001', 'Ali Ahmed', 'Cairo', '01011112222');
--INSERT INTO CUSTOMER (CUS_ID, NAME, ADDRESS, CONTACT_NUMBER) VALUES ('C002', 'Sara Mohamed', 'Giza', '01033334444');
--INSERT INTO CUSTOMER (CUS_ID, NAME, ADDRESS, CONTACT_NUMBER) VALUES ('C003', 'Omar Khaled', 'Alex', '01055556666');

--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P001', 'Laptop', 'Electronics', 10, 15000.00);
--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P002', 'Mouse', 'Electronics', 50, 200.00);
--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P003', 'Notebook', 'Stationery', 100, 50.00);
--
--INSERT INTO SALE (SALE_ID, CUS_NAME, CUS_CONTACT, TOTAL, USER_ID) VALUES ('S001', 'Ali Ahmed', '01011112222', 15200.00, NULL);
--INSERT INTO SALE (SALE_ID, CUS_NAME, CUS_CONTACT, TOTAL, USER_ID) VALUES ('S002', 'Sara Mohamed', '01033334444', 250.00, NULL);
--
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S001', 'P001', 1, 15000.00);
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S001', 'P002', 1, 200.00);
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S002', 'P003', 5, 50.00);


--DELETE FROM SALE_DETAIL;
--DELETE FROM PRODUCT;

--
--UPDATE SALE
--SET USER_ID = 'U003'
--WHERE USER_ID IS NULL;
--
--COMMIT;
--
--INSERT INTO SALE (SALE_ID, CUS_NAME, CUS_CONTACT, TOTAL, USER_ID) VALUES ('S003', 'Omar Khaled', '01033334444', 50.00, 'U003');

--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P001', 'Espresso', 'Coffee', 30, 50.00);
--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P002', 'Cola', 'Soft Drinks', 60, 50.00);
--INSERT INTO PRODUCT (PRODUCT_ID, PRODUCT_NAME, PRODUCT_TYPE, STOCK, PRICE) VALUES ('P003', 'Ice Cream', 'Desserts', 40, 70.00);

--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S001', 'P001', 1, 50.00);   
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S001', 'P003', 2, 70.00);
--
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S002', 'P002', 1, 50.00);
--
--INSERT INTO SALE_DETAIL (SALE_ID, PRODUCT_ID, QUANTITY, UNIT_PRICE) VALUES ('S003', 'P001', 1, 50.00);


--UPDATE SALE SET TOTAL = 190 WHERE SALE_ID = 'S001';  -- Espresso 50 + Ice Cream 140
--UPDATE SALE SET TOTAL = 50 WHERE SALE_ID = 'S002';   -- Cola 50
--UPDATE SALE SET TOTAL = 50 WHERE SALE_ID = 'S003';   -- Espresso 50


--SELECT s.SALE_ID, s.TOTAL, sd.PRODUCT_ID, p.PRODUCT_NAME, sd.QUANTITY, sd.UNIT_PRICE, (sd.QUANTITY * sd.UNIT_PRICE) AS LINE_TOTAL
--FROM SALE s
--JOIN SALE_DETAIL sd ON s.SALE_ID = sd.SALE_ID
--JOIN PRODUCT p ON sd.PRODUCT_ID = p.PRODUCT_ID
--ORDER BY s.SALE_ID;

--DESC PRODUCT;

--UPDATE PRODUCT SET IMAGE = '/MenuImages/Cake.jpg' WHERE PRODUCT_ID = 'P004';  -- Cake
--
--UPDATE PRODUCT SET IMAGE = '/MenuImages/Espresso.jpg' WHERE PRODUCT_ID = 'P001';  -- Espresso
--
--UPDATE PRODUCT SET IMAGE = '/MenuImages/Cola.jpg' WHERE PRODUCT_ID = 'P002';  -- Cola
--
--UPDATE PRODUCT SET IMAGE = '/MenuImages/IceCream.jpg' WHERE PRODUCT_ID = 'P003';  -- Ice Cream

--UPDATE PRODUCT SET IMAGE = '/MenuImages/Espresso.jpg' WHERE PRODUCT_ID = 'P001';  -- Espresso

--CREATE OR REPLACE TRIGGER trg_auto_create_user
--AFTER INSERT ON EMPLOYEE
--FOR EACH ROW
--BEGIN
--   --insert employee into USER table
--    INSERT INTO "USER" (
--        USER_NAME, 
--        PASSWORD, 
--        ROLE, 
--        EMPLOYEE_ID, 
--        CREATED_AT
--    ) VALUES (
--        LOWER(:NEW.FIRST_NAME),               --USER-NAME -> FIRST_NAME
--        :NEW.PASSWORD,                        
--        :NEW.POSITION,                         
--        :NEW.EMP_ID,                          
--        :NEW.CREATED_AT                       
--    );
--END;


--CREATE SEQUENCE sale_seq START WITH 1 INCREMENT BY 1;
--
--
--CREATE OR REPLACE TRIGGER trg_sale_id
--BEFORE INSERT ON SALE
--FOR EACH ROW
--BEGIN
--    IF :NEW.SALE_ID IS NULL THEN
--        :NEW.SALE_ID := 'S' || LPAD(sale_seq.NEXTVAL, 3, '0');
--    END IF;
--END;



--DROP SEQUENCE sale_seq;
--
--CREATE SEQUENCE sale_seq START WITH 7 INCREMENT BY 1;

--UPDATE SALE 
--SET EMPLOYEE_ID = 'E002' 
--WHERE EMPLOYEE_ID IS NULL;
--
--COMMIT;

--/
--COMMIT;


ALTER TABLE SALE_DETAIL 
ADD CONSTRAINT fk_sale_id 
FOREIGN KEY (SALE_ID) REFERENCES SALE(SALE_ID);


ALTER TABLE SALE_DETAIL 
ADD CONSTRAINT fk_product_id 
FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID);
